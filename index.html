<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ í†µí•© ê´€ë¦¬</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --border: #E0E0E0; --accent: #0055A4; }
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; color: #333; }
        header { padding: 10px 20px; border-bottom: 1px solid var(--border); background: white; z-index: 1000; display: flex; justify-content: space-between; align-items: center; height: 50px; flex-shrink: 0; }
        h1 { margin: 0; font-size: 16px; font-weight: 700; color: var(--accent); }
        .switch-container { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }

        .layout { display: flex; flex: 1; overflow: hidden; }
        #map { flex: 1; height: 100%; z-index: 1; }
        .sidebar { width: 300px; display: flex; flex-direction: column; background: #ffffff; border-left: 1px solid var(--border); z-index: 2; }
        .sidebar-content { padding: 15px; overflow-y: auto; flex: 1; }
        body.full-map-mode .sidebar { display: none; }

        /* ìƒì„¸ ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .draggable-label-container {
            background: white; border-width: 2px; border-style: solid; border-radius: 8px;
            padding: 10px; box-shadow: 4px 4px 12px rgba(0,0,0,0.15);
            text-align: left; font-size: 11px; width: 210px; cursor: grab;
        }
        .label-title { font-weight: 700; font-size: 12px; display: block; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 6px; }
        .section-tag { font-size: 9px; color: #999; font-weight: bold; margin-top: 4px; display: block; }
        .label-content { display: block; color: #444; margin: 2px 0; line-height: 1.4; }

        /* íˆ´íŒ (í˜¸ë²„ íŒì—…) */
        .leaflet-tooltip { padding: 12px; border-radius: 8px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 220px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¢ í”„ë¡œì íŠ¸ í†µí•© ê´€ë¦¬</h1>
    <div class="switch-container">
        Label Mode
        <label class="switch">
            <input type="checkbox" id="mode-toggle">
            <span class="slider"></span>
        </label>
    </div>
</header>

<div class="layout">
    <div id="map"></div>
    <div class="sidebar">
        <div class="sidebar-content">
            <h3 style="font-size: 14px; margin-top:0;">ğŸ“‹ ë¦¬ìŠ¤íŠ¸</h3>
            <table id="table-body" style="width:100%; border-collapse: collapse; font-size:11px;"></table>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    function getStepColor(stage) {
        if (stage.includes("ì œì¡°") || stage.includes("í˜‘ì•½")) return "#E53935"; 
        if (stage.includes("ì„¤ê³„")) return "#1E88E5"; 
        if (stage.includes("ì»¨ì„¤íŒ…")) return "#43A047"; 
        if (stage.includes("ë°œì£¼")) return "#FB8C00"; 
        return "#757575";
    }

    const projects = [
        { id: 1, name: "ì„œìš¸ëŒ€ 68-1ê´€ ë¦¬ëª¨ë¸ë§", loc: "ê´€ì•…êµ¬", client: "ì„œìš¸ëŒ€/íƒ„ì†Œì¤‘ë¦½ë‹¨", partner: "-", area: "475ã¡", floor: "ì§€ìƒ4ì¸µ", vol: "33", pkg: "+ê³µì¡°+Grid+ICT", stage: "ì œì¡°", lat: 37.4533, lng: 126.9571 },
        { id: 2, name: "ì„±ë‚¨ ì •ìˆ˜ì¥ ë¦¬ëª¨ë¸ë§", loc: "ì„±ë‚¨ì‹œ", client: "ìˆ˜ìì›ê³µì‚¬", partner: "-", area: "514ã¡", floor: "ì§€ìƒ2ì¸µ", vol: "74(91)", pkg: "+ê³µì¡°+Grid+ICT", stage: "ë¬¼í’ˆì‚¬ìš©í˜‘ì•½ì¤€ë¹„", lat: 37.4127, lng: 127.1087 },
        { id: 3, name: "ê´‘ëª…í•™ì˜¨ ê³µì›ê´€ë¦¬ë™", loc: "ê´‘ëª…ì‹œ", client: "ê²½ê¸°ë„ì‹œê³µì‚¬", partner: "ì†”ë£¨ì…˜ë¹„ì¦ˆíŒ€", area: "660ã¡", floor: "ì§€ìƒ2ì¸µ", vol: "58", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ë°œì£¼ëŒ€ê¸°ì¤‘", lat: 37.4101, lng: 126.8635 },
        { id: 4, name: "íƒœí‰ë¡œë¹Œë”© FIT ì ìš© ë¦¬ëª¨ë¸ë§", loc: "ì¤‘êµ¬", client: "ì´ì§€ìŠ¤ìì‚°ìš´ìš©", partner: "ì‚¼ì„±ì „ì", area: "44,035ã¡", floor: "ì§€í•˜7/ì§€ìƒ26", vol: "3,097", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ê¸°ë³¸ì„¤ê³„", lat: 37.5630, lng: 126.9757 },
        { id: 5, name: "ì„œìš¸ì—­ ì—…ë¬´ì§€êµ¬ í†µí•©ê¸°ìˆ  ì»¨ì„¤íŒ…", loc: "ì¤‘êµ¬", client: "ì‚¼ì„±ë¬¼ì‚°/ì´ì§€ìŠ¤", partner: "ì‚¼ì„±ë¬¼ì‚°", area: "122,542ã¡", floor: "ì§€í•˜9/ì§€ìƒ34", vol: "276", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì»¨ì„¤íŒ…", lat: 37.5563, lng: 126.9744 },
        { id: 6, name: "ë™ì„œìš¸í„°ë¯¸ë„ FIT ì»¨ì„¤íŒ…", loc: "ê´‘ì§„êµ¬", client: "ì‹ ì„¸ê³„ í”„ë¼í¼í‹°", partner: "ì‚¼ì„±ì „ì", area: "383,074ã¡", floor: "ì§€í•˜7/ì§€ìƒ43", vol: "506", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì»¨ì„¤íŒ…", lat: 37.5356, lng: 127.0957 },
        { id: 7, name: "ASML ì›ì‚¼ë©´ Office", loc: "ìš©ì¸ì‹œ", client: "ASML ì½”ë¦¬ì•„", partner: "ì‚¼ìš°/í•´ì•ˆ ë“±", area: "32,000ã¡", floor: "ì§€í•˜4/ì§€ìƒ10", vol: "1100", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ë°œì£¼ëŒ€ê¸°ì¤‘", lat: 37.1543, lng: 127.3182 },
        { id: 8, name: "í¬ë˜í”„í†¤ C3 ì‹ ì¶•", loc: "ì„±ë™êµ¬", client: "í¬ë˜í”„í†¤", partner: "ì‹œìŠ¤í…œ ë©", area: "9,600ã¡", floor: "ì§€í•˜4/ì§€ìƒ11", vol: "252", pkg: "+ê³µì¡°+Grid+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5408, lng: 127.0574 },
        { id: 9, name: "ì• í”Œíƒ€ì›Œ", loc: "ì†¡íŒŒêµ¬", client: "ì• í”Œì—ì´ì•¤ì— ", partner: "-", area: "4,741ã¡", floor: "ì§€í•˜6/ì§€ìƒ17", vol: "ê²€í† ì¤‘", pkg: "ê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5105, lng: 127.0790 },
        { id: 10, name: "ê°•ë‚¨ 358íƒ€ì›Œ ë¦¬ëª¨ë¸ë§", loc: "ê°•ë‚¨êµ¬", client: "HDC ìì‚°ìš´ìš©", partner: "ë¯¸ë˜/ì´ì§€ìŠ¤", area: "37,597ã¡", floor: "ì§€í•˜7/ì§€ìƒ20", vol: "1523", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.4950, lng: 127.0297 },
        { id: 11, name: "ë…¼í˜„ë™ ê°œë°œ FIT ê²€í† ", loc: "ê°•ë‚¨êµ¬", client: "ì‹ ì„¸ê³„ ì„¼íŠ¸ëŸ´", partner: "í•´ì•ˆ/ê±´ì›", area: "45,116ã¡", floor: "ì§€í•˜7/ì§€ìƒ20", vol: "1926", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5111, lng: 127.0225 },
        { id: 12, name: "ì‚¼ì„±ë™ 168 ì—…ë¬´ì‹œì„¤", loc: "ê°•ë‚¨êµ¬", client: "ë‘ë‚˜ë¬´", partner: "ìº¡ìŠ¤í†¤/ì‚¼ìš°", area: "34,527ã¡", floor: "ì§€í•˜9/ì§€ìƒ28", vol: "500", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5103, lng: 127.0629 },
        { id: 13, name: "ê´€ìˆ˜8ì§€êµ¬ ì¬ê°œë°œ", loc: "ì¢…ë¡œêµ¬", client: "NH íˆ¬ìì¦ê¶Œ", partner: "í•œë¦¼/KCC", area: "50,823ã¡", floor: "ì§€í•˜8/ì§€ìƒ25", vol: "1,150", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5685, lng: 126.9900 },
        { id: 14, name: "ì—­ì‚¼ SI íƒ€ì›Œ", loc: "ê°•ë‚¨êµ¬", client: "ì´ì§€ìŠ¤ìì‚°ìš´ìš©", partner: "-", area: "66,202ã¡", floor: "ì§€í•˜8/ì§€ìƒ25", vol: "1960", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5015, lng: 127.0377 }
    ];

    // ì§€ë„ ì´ˆê¸°í™” (ì¤Œ ì»¨íŠ¸ë¡¤ í¬í•¨)
    const map = L.map('map').setView([37.48, 127.05], 11);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const projectLayer = L.layerGroup().addTo(map);
    const draggableGroup = L.layerGroup().addTo(map);
    const markers = [];

    projects.forEach((p, idx) => {
        const color = getStepColor(p.stage);
        
        // ì‚¬ì´ë“œë°” ëª©ë¡ ìƒì„±
        document.getElementById('table-body').innerHTML += `
            <tr style="border-bottom:1px solid #eee;">
                <td style="padding:10px;"><b>${p.name}</b><br><span style="color:${color}; font-size:10px;">â— ${p.stage}</span></td>
            </tr>
        `;

        // ì§€ë„ í•€ ìƒì„±
        const pin = L.circleMarker([p.lat, p.lng], { radius: 7, fillColor: color, color: "#fff", weight: 2, fillOpacity: 0.9 }).addTo(projectLayer);

        // íˆ´íŒ êµ¬ì„± (ë¼ë²¨ ëª¨ë“œ OFF ì‹œ)
        const tooltipHtml = `
            <div style="font-weight:700; color:${color}; font-size:13px; border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:5px;">${p.name}</div>
            <div style="font-size:11px; line-height:1.5;">
                ğŸ  ê°œìš”: ${p.area} / ${p.floor}<br>
                ğŸ¢ ë°œì£¼: ${p.client} (${p.partner})<br>
                ğŸ“¦ ìˆ˜ëŸ‰: <b style="color:#e67e22;">${p.vol} ê°œ</b>
            </div>
        `;

        pin.on('mouseover', function() { this.setRadius(12); this.setStyle({ weight: 4 }); });
        pin.on('mouseout', function() { this.setRadius(7); this.setStyle({ weight: 2 }); });

        markers.push({ pin, data: p, color, tooltipHtml });
    });

    function updateMode() {
        const isLabelMode = document.getElementById('mode-toggle').checked;
        draggableGroup.clearLayers();

        if (isLabelMode) {
            document.body.classList.add('full-map-mode');
            
            const b = map.getBounds();
            const n = b.getNorth(), s = b.getSouth(), e = b.getEast(), w = b.getWest();

            markers.forEach((m, i) => {
                m.pin.unbindTooltip();

                // 4ë©´ ë¶„ì‚° ë°°ì¹˜ ë¡œì§ (ê²¹ì¹¨ ë°©ì§€)
                let lLat, lLng;
                if (i < 4) { // ì™¼ìª½ ë©´ (1~4ë²ˆ)
                    lLat = n - ((n - s) / 5 * (i + 1));
                    lLng = w + (e - w) * 0.12;
                } else if (i < 8) { // ì˜¤ë¥¸ìª½ ë©´ (5~8ë²ˆ)
                    lLat = n - ((n - s) / 5 * (i - 3));
                    lLng = e - (e - w) * 0.12;
                } else if (i < 11) { // ìœ„ìª½ ë©´ (9~11ë²ˆ)
                    lLat = n - (n - s) * 0.1;
                    lLng = w + ((e - w) / 4 * (i - 7));
                } else { // ì•„ë˜ìª½ ë©´ (12~14ë²ˆ)
                    lLat = s + (n - s) * 0.1;
                    lLng = w + ((e - w) / 4 * (i - 10));
                }

                const labelHtml = `
                    <div class="draggable-label-container" style="border-color: ${m.color};">
                        <span class="label-title" style="color: ${m.color};">${m.data.id}. ${m.data.name}</span>
                        <span class="section-tag">[ê°œìš” ë° ê·œëª¨]</span>
                        <span class="label-content">${m.data.client} | ${m.data.floor}</span>
                        <span class="section-tag">[ë¬¼ëŸ‰ ë° ë‹¨ê³„]</span>
                        <span class="label-content"><b>${m.data.vol}ê°œ</b> | ${m.data.pkg}</span>
                        <span class="label-content" style="color:${m.color}; font-weight:bold; margin-top:5px; border-top:1px solid #f0f0f0; padding-top:4px;">í˜„ì¬: ${m.data.stage}</span>
                    </div>
                `;

                const labelIcon = L.divIcon({ html: labelHtml, className: '', iconAnchor: [110, 45] });
                const labelMarker = L.marker([lLat, lLng], { icon: labelIcon, draggable: true }).addTo(draggableGroup);
                
                const polyline = L.polyline([[m.data.lat, m.data.lng], [lLat, lLng]], { 
                    color: m.color, weight: 1, dashArray: '5, 5', opacity: 0.3 
                }).addTo(draggableGroup);

                labelMarker.on('drag', (ev) => polyline.setLatLngs([[m.data.lat, m.data.lng], ev.target.getLatLng()]));
            });
        } else {
            document.body.classList.remove('full-map-mode');
            markers.forEach(m => m.pin.bindTooltip(m.tooltipHtml, { direction: 'top', opacity: 1 }));
        }
        setTimeout(() => map.invalidateSize(), 400);
    }

    document.getElementById('mode-toggle').addEventListener('change', updateMode);
    updateMode();
</script>
</body>
</html>

