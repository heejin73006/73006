<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ í†µí•© ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --border: #E8E8E8; --accent: #1565C0; --bg: #F5F7FA; }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: var(--bg); color: #333; }
        
        header { 
            padding: 0 25px; background: white; z-index: 1000; 
            display: flex; justify-content: space-between; align-items: center; 
            height: 60px; flex-shrink: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        h1 { margin: 0; font-size: 18px; font-weight: 700; color: var(--accent); letter-spacing: -0.5px; }

        .switch-container { display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 600; color: #555; }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #CBD5E0; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(22px); }

        .layout { display: flex; flex: 1; overflow: hidden; }
        #map { flex: 1; height: 100%; z-index: 1; background: #e0e5eb; }
        
        .sidebar { width: 340px; display: flex; flex-direction: column; background: #ffffff; border-left: 1px solid var(--border); z-index: 2; box-shadow: -2px 0 10px rgba(0,0,0,0.03); }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); background: #fcfcfc; }
        .sidebar-content { padding: 10px; overflow-y: auto; flex: 1; background: #f9f9f9; }
        body.full-map-mode .sidebar { display: none; }

        .sidebar-content::-webkit-scrollbar { width: 6px; }
        .sidebar-content::-webkit-scrollbar-track { background: transparent; }
        .sidebar-content::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 10px; }

        .project-card {
            background: white; border-radius: 10px; padding: 15px; margin-bottom: 12px;
            border: 1px solid #edf2f7; transition: all 0.2s; cursor: pointer;
        }
        .project-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.08); border-color: #d1d9e6; }
        .card-name { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: #1a202c; display: block; }
        .card-info { font-size: 11px; color: #718096; line-height: 1.6; }
        .card-info b { color: #4a5568; }
        .status-badge { 
            display: inline-block; padding: 3px 8px; border-radius: 4px; 
            font-size: 10px; font-weight: 700; color: white; margin-bottom: 8px; 
        }

        .draggable-label-container {
            background: white; border-width: 2px; border-style: solid; border-radius: 12px;
            padding: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: left; font-size: 11px; width: 250px; cursor: grab;
        }
        .label-title { font-weight: 700; font-size: 12px; display: block; border-bottom: 1px solid #f0f0f0; padding-bottom: 6px; margin-bottom: 8px; }
        .section-tag { font-size: 9px; color: #A0AEC0; font-weight: bold; margin-top: 8px; display: block; text-transform: uppercase; }
        .label-content { display: block; color: #4A5568; margin: 2px 0; line-height: 1.5; }

        .legend {
            position: absolute; bottom: 30px; right: 30px; background: white; padding: 12px;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; font-size: 11px;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }

        .leaflet-tooltip { padding: 12px; border-radius: 8px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); min-width: 240px; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¢ í”„ë¡œì íŠ¸ í†µí•© ê´€ë¦¬ <small style="font-weight: 300; font-size: 12px; color: #999; margin-left: 10px;">Smart Dashboard</small></h1>
    <div class="switch-container">
        Label Mode
        <label class="switch">
            <input type="checkbox" id="mode-toggle">
            <span class="slider"></span>
        </label>
    </div>
</header>

<div class="layout">
    <div id="map"></div>
    <div class="sidebar">
        <div class="sidebar-header">
            <h3 style="font-size: 15px; margin:0;">ğŸ“‹ í”„ë¡œì íŠ¸ ë¦¬ìŠ¤íŠ¸</h3>
            <p style="font-size: 11px; color: #999; margin: 5px 0 0 0;">ì´ 14ê°œì˜ í”„ë¡œì íŠ¸ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
        <div class="sidebar-content" id="sidebar-list"></div>
    </div>
</div>

<div class="legend">
    <div style="font-weight: bold; margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 4px;">ë‹¨ê³„ë³„ ì•ˆë‚´</div>
    <div class="legend-item"><div class="legend-color" style="background:#D84315;"></div> ì œì¡°/í˜‘ì•½ (ì§„í–‰)</div>
    <div class="legend-item"><div class="legend-color" style="background:#FB8C00;"></div> ë°œì£¼ ì¤€ë¹„ (ëŒ€ê¸°)</div>
    <div class="legend-item"><div class="legend-color" style="background:#1565C0;"></div> ì„¤ê³„ ë‹¨ê³„ (ê¸°íš)</div>
    <div class="legend-item"><div class="legend-color" style="background:#42A5F5;"></div> ì»¨ì„¤íŒ…/ê²€í†  (ì‚¬ì „)</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    function getStepColor(stage) {
        if (stage.includes("ì œì¡°") || stage.includes("í˜‘ì•½")) return "#D84315";
        if (stage.includes("ë°œì£¼")) return "#FB8C00";
        if (stage.includes("ì„¤ê³„")) return "#1565C0";
        if (stage.includes("ì»¨ì„¤íŒ…")) return "#42A5F5";
        return "#9E9E9E";
    }

    const projects = [
        { id: 1, name: "ì„œìš¸ëŒ€ 68-1ê´€ ë¦¬ëª¨ë¸ë§", client: "ì„œìš¸ëŒ€", partner: "íƒ„ì†Œì¤‘ë¦½ë‹¨", area: "475ã¡", floor: "ì§€ìƒ4ì¸µ", vol: "33", pkg: "+ê³µì¡°+Grid+ICT", stage: "ì œì¡°", lat: 37.4533, lng: 126.9571 },
        { id: 2, name: "ì„±ë‚¨ ì •ìˆ˜ì¥ ë¦¬ëª¨ë¸ë§", client: "ìˆ˜ìì›ê³µì‚¬", partner: "-", area: "514ã¡", floor: "ì§€ìƒ2ì¸µ", vol: "74(91)", pkg: "+ê³µì¡°+Grid+ICT", stage: "ë¬¼í’ˆì‚¬ìš©í˜‘ì•½ì¤€ë¹„", lat: 37.4127, lng: 127.1087 },
        { id: 3, name: "ê´‘ëª…í•™ì˜¨ ê³µì›ê´€ë¦¬ë™", client: "ê²½ê¸°ë„ì‹œê³µì‚¬", partner: "ì†”ë£¨ì…˜ë¹„ì¦ˆíŒ€", area: "660ã¡", floor: "ì§€ìƒ2ì¸µ", vol: "58", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ë°œì£¼ëŒ€ê¸°ì¤‘", lat: 37.4101, lng: 126.8635 },
        { id: 4, name: "íƒœí‰ë¡œë¹Œë”© FIT ë¦¬ëª¨ë¸ë§", client: "ì´ì§€ìŠ¤ìì‚°ìš´ìš©", partner: "ì‚¼ì„±ì „ì", area: "44,035ã¡", floor: "ì§€í•˜7/ì§€ìƒ26", vol: "3,097", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ê¸°ë³¸ì„¤ê³„", lat: 37.5630, lng: 126.9757 },
        { id: 5, name: "ì„œìš¸ì—­ ì—…ë¬´ì§€êµ¬ ì»¨ì„¤íŒ…", client: "ì´ì§€ìŠ¤", partner: "ì‚¼ì„±ë¬¼ì‚°", area: "122,542ã¡", floor: "ì§€í•˜9/ì§€ìƒ34", vol: "276", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì»¨ì„¤íŒ…", lat: 37.5563, lng: 126.9744 },
        { id: 6, name: "ë™ì„œìš¸í„°ë¯¸ë„ FIT ì»¨ì„¤íŒ…", client: "ì‹ ì„¸ê³„", partner: "ì‚¼ì„±ì „ì", area: "383,074ã¡", floor: "ì§€í•˜7/ì§€ìƒ43", vol: "506", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì»¨ì„¤íŒ…", lat: 37.5356, lng: 127.0957 },
        { id: 7, name: "ASML ì›ì‚¼ë©´ Office", client: "ASML ì½”ë¦¬ì•„", partner: "ì‚¼ìš°/í•´ì•ˆ", area: "32,000ã¡", floor: "ì§€í•˜4/ì§€ìƒ10", vol: "1100", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ë°œì£¼ëŒ€ê¸°ì¤‘", lat: 37.1543, lng: 127.3182 },
        { id: 8, name: "í¬ë˜í”„í†¤ C3 ì‹ ì¶•", client: "í¬ë˜í”„í†¤", partner: "ì‹œìŠ¤í…œ ë©", area: "9,600ã¡", floor: "ì§€í•˜4/ì§€ìƒ11", vol: "252", pkg: "+ê³µì¡°+Grid+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5408, lng: 127.0574 },
        { id: 9, name: "ì• í”Œíƒ€ì›Œ", client: "ì• í”Œì—ì´ì•¤ì— ", partner: "-", area: "4,741ã¡", floor: "ì§€í•˜6/ì§€ìƒ17", vol: "ê²€í† ì¤‘", pkg: "ê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5105, lng: 127.0790 },
        { id: 10, name: "ê°•ë‚¨ 358íƒ€ì›Œ ë¦¬ëª¨ë¸ë§", client: "HDC ìì‚°ìš´ìš©", partner: "ë¯¸ë˜/ì´ì§€ìŠ¤", area: "37,597ã¡", floor: "ì§€í•˜7/ì§€ìƒ20", vol: "1523", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.4950, lng: 127.0297 },
        { id: 11, name: "ë…¼í˜„ë™ ê°œë°œ FIT ê²€í† ", client: "ì‹ ì„¸ê³„ ì„¼íŠ¸ëŸ´", partner: "í•´ì•ˆ/ê±´ì›", area: "45,116ã¡", floor: "ì§€í•˜7/ì§€ìƒ20", vol: "1926", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5111, lng: 127.0225 },
        { id: 12, name: "ì‚¼ì„±ë™ 168 ì—…ë¬´ì‹œì„¤", client: "ë‘ë‚˜ë¬´", partner: "ìº¡ìŠ¤í†¤/ì‚¼ìš°", area: "34,527ã¡", floor: "ì§€í•˜9/ì§€ìƒ28", vol: "500", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5103, lng: 127.0629 },
        { id: 13, name: "ê´€ìˆ˜8ì§€êµ¬ ì¬ê°œë°œ", client: "NH íˆ¬ìì¦ê¶Œ", partner: "í•œë¦¼/KCC", area: "50,823ã¡", floor: "ì§€í•˜8/ì§€ìƒ25", vol: "1,150", pkg: "+ê³µì¡°+FTU+ICT", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5685, lng: 126.9900 },
        { id: 14, name: "ì—­ì‚¼ SI íƒ€ì›Œ", client: "ì´ì§€ìŠ¤ìì‚°ìš´ìš©", partner: "-", area: "66,202ã¡", floor: "ì§€í•˜8/ì§€ìƒ25", vol: "1960", pkg: "ëŒ€ì•ˆê²€í† ì¤‘", stage: "ì‚¬ì „ì»¨ì„¤íŒ…", lat: 37.5015, lng: 127.0377 }
    ];

    const map = L.map('map', {
        minZoom: 7,
        maxZoom: 18,
        maxBounds: [[32.0, 123.0], [44.0, 133.0]],
        maxBoundsViscosity: 1.0
    }).setView([37.48, 127.05], 11);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const projectLayer = L.layerGroup().addTo(map);
    const draggableGroup = L.layerGroup().addTo(map);
    const markers = [];

    projects.forEach((p) => {
        const color = getStepColor(p.stage);
        const volText = p.vol === 'ê²€í† ì¤‘' ? 'ê²€í† ì¤‘' : p.vol + 'ê°œ';
        
        // [ìˆ˜ì •] ì‚¬ì´ë“œë°” ì¹´ë“œ - ê·œëª¨ ë° ë¬¼ëŸ‰ ì •ë³´ ì¶”ê°€
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `
            <span class="status-badge" style="background:${color}">${p.stage}</span>
            <span class="card-name">${p.name}</span>
            <div class="card-info">
                ğŸ¢ <b>ë°œì£¼(í˜‘ë ¥):</b> ${p.client}(${p.partner})<br>
                ğŸ“ <b>ê·œëª¨:</b> ${p.floor} / ${p.area}<br>
                ğŸ“¦ <b>ë¬¼ëŸ‰:</b> ${volText}<br>
                ğŸ›  <b>íŒ¨í‚¤ì§•:</b> ${p.pkg}
            </div>
        `;
        card.onclick = () => { map.flyTo([p.lat, p.lng], 14); pin.openTooltip(); };
        document.getElementById('sidebar-list').appendChild(card);

        // ì§€ë„ í•€ & í˜¸ë²„ íˆ´íŒ
        const pin = L.circleMarker([p.lat, p.lng], { radius: 7, fillColor: color, color: "#fff", weight: 2, fillOpacity: 0.9 }).addTo(projectLayer);
        const tooltipHtml = `
            <div style="font-weight:700; color:${color}; font-size:13px; border-bottom:1px solid #eee; padding-bottom:5px; margin-bottom:5px;">${p.name}</div>
            <div style="font-size:11px; line-height:1.6;">
                ğŸ¢ <b>ë°œì£¼(í˜‘ë ¥):</b> ${p.client}(${p.partner})<br>
                ğŸ  <b>ê·œëª¨:</b> ${p.area} / ${p.floor}<br>
                ğŸ“¦ <b>ìˆ˜ëŸ‰:</b> <b style="color:#333;">${volText}</b><br>
                ğŸ›  <b>íŒ¨í‚¤ì§•:</b> <span style="color:${color}; font-weight:bold;">${p.pkg}</span>
            </div>
        `;
        pin.on('mouseover', function() { this.setRadius(12); });
        pin.on('mouseout', function() { this.setRadius(7); });
        markers.push({ pin, data: p, color, tooltipHtml });
    });

    function updateMode() {
        const isLabelMode = document.getElementById('mode-toggle').checked;
        draggableGroup.clearLayers();

        if (isLabelMode) {
            document.body.classList.add('full-map-mode');
            const b = map.getBounds();
            const n = b.getNorth(), s = b.getSouth(), e = b.getEast(), w = b.getWest();

            markers.forEach((m, i) => {
                m.pin.unbindTooltip();
                let lLat, lLng;
                if (i < 4) { lLat = n - ((n - s) / 5 * (i + 1)); lLng = w + (e - w) * 0.12; } 
                else if (i < 8) { lLat = n - ((n - s) / 5 * (i - 3)); lLng = e - (e - w) * 0.12; } 
                else if (i < 11) { lLat = n - (n - s) * 0.1; lLng = w + ((e - w) / 4 * (i - 7)); } 
                else { lLat = s + (n - s) * 0.1; lLng = w + ((e - w) / 4 * (i - 10)); }

                const volLabel = m.data.vol === 'ê²€í† ì¤‘' ? 'ê²€í† ì¤‘' : m.data.vol + 'ê°œ';

                const labelHtml = `
                    <div class="draggable-label-container" style="border-color: ${m.color};">
                        <span class="label-title" style="color: ${m.color};">${m.data.name}</span>
                        <span class="section-tag">[ë°œì£¼ ë° í˜‘ë ¥]</span>
                        <span class="label-content">${m.data.client}(${m.data.partner})</span>
                        <span class="section-tag">[ê·œëª¨ ë° íŒ¨í‚¤ì§•]</span>
                        <span class="label-content">${m.data.floor} / ${m.data.area}</span>
                        <span class="label-content">ğŸ›  <b>${m.data.pkg}</b></span>
                        <span class="label-content" style="border-top:1px dashed #eee; margin-top:5px; padding-top:4px;">ğŸ“¦ ìˆ˜ëŸ‰: <b>${volLabel}</b></span>
                    </div>
                `;
                const labelIcon = L.divIcon({ html: labelHtml, className: '', iconAnchor: [125, 60] });
                const labelMarker = L.marker([lLat, lLng], { icon: labelIcon, draggable: true }).addTo(draggableGroup);
                const polyline = L.polyline([[m.data.lat, m.data.lng], [lLat, lLng]], { color: m.color, weight: 1.5, dashArray: '6, 6', opacity: 0.4 }).addTo(draggableGroup);
                labelMarker.on('drag', (ev) => polyline.setLatLngs([[m.data.lat, m.data.lng], ev.target.getLatLng()]));
            });
        } else {
            document.body.classList.remove('full-map-mode');
            markers.forEach(m => m.pin.bindTooltip(m.tooltipHtml, { direction: 'top', opacity: 1 }));
        }
        setTimeout(() => map.invalidateSize(), 400);
    }

    document.getElementById('mode-toggle').addEventListener('change', updateMode);
    updateMode();
</script>
</body>
</html>
